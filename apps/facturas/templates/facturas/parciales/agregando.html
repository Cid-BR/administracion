<div class="btn-group" role="group" aria-label="Basic example">
</div>
<div class="row" style="padding-top:2%;">
    <div class="col-xs-6">
        <h5>Factura</h5>
    </div>
    <div class="col-xs-6">
        <b class="">Cliente: </b> {{factura.cliente}} -
        <b class="">Total: </b> <em id="total_factura">{{ factura.total }}</em>
    </div>
</div>
<hr>
<div class="row">
    <div class="col-xs-4">
        <div class="box mdl-shadow--2dp" style="padding: 3%; background-color: white">
            <strong>Añadir Artículo</strong>
            <form class="post-form text-left" id="buscar_articulo">
                <div class="input-group">
                    <div id="borrar_codigo" class="input-group-addon clear-btn btn btn-danger"><i class="fi-x"></i></div>
                    <input type="text" id="codigo_articulo" class="form-control" placeholder="Buscar por código o nombre">
                </div>
            </form>
            <ul id="lista-articulos" class="list-group" style="padding-top: 1.5%;"></ul>
            <hr>
            <div class="box gray box-form">
                <form id="form_agregar_articulo" method="POST" class="hidden" action="{% url 'agregar_articulo_factura' factura.id %}" token="{{ csrf_token }}">
                    <input type="number" class="hidden" id="id_articulo">
                    <strong>Art: </strong> <span id="nombre_articulo"></span> |
                    <strong>Precio: $</strong> <span id="precio_articulo"></span>
                    <hr>

                    <p>
                        <label for="id_cantidad_articulo">Cantidad</label>
                        <input type="number" class="form-control" id="id_cantidad_articulo">
                    </p>
                    <button type="submint" class="btn btn-block btn-primary">Añadir</button>
                </form>
            </div>
        </div>
        <hr>
        <div class="box mdl-shadow--2dp" style="padding: 3%; background-color: white">
            <strong>Añadir Servicios</strong>
            <form class="post-form text-left" id="buscar_servicio">
                <div class="input-group">
                    <div id="borrar_codigo_p" class="input-group-addon clear-btn btn btn-danger"><i class="fi-x"></i></div>
                    <input type="text" id="codigo_producto" class="form-control" placeholder="Buscar por código o nombre">
                </div>
            </form>
            <ul id="lista-servicios" class="list-group"></ul>
            <hr>
            <div class="box gray box-form">
                <form id="agregar_servicio" class="post-form text-left hidden" action="{% url 'agregar_servicio_factura' factura.id %}" token="{{ csrf_token }}">
                    <input class="hidden" required="true" id="id_tipo_servicio">
                    <strong>Prod: </strong> <span id="nombre_producto"></span> |
                    <strong>Precio: $</strong> <span id="precio_producto"></span>
                    <hr>
                    <p>
                        <label for="cantidad_servicio">Cantidad:</label>
                        <input type="number" name="cantidad" value="1" class="form-control" id="cantidad_servicio" required="">
                    </p>
                    <button type="submit" class="btn btn-success">Agregar</button>
                </form>
            </div>
        </div>
        <hr> {% if factura.pago == 'credito' %}
        <div class="box mdl-shadow--2dp box-form">
            <div>
                <strong>Fecha Límite</strong>
                <input class="form-control" type="date" value="" id="fecha-limite">
            </div>
        </div>
        <hr> {% endif %}
        <form id="cerrar-factura" action="{% url 'cobrar_factura' factura.id %}" method="POST" token="{{csrf_token}}">
            <button type="submit" class="btn btn-primary btn-block">Cerrar Factura</button>
        </form>
    </div>
    <div class="col-xs-8">
        <table class="table table-striped">
            <thead class="thead-inverse">
                <tr>
                    <th>Concepto</th>
                    <th>Precio</th>
                    <th>Cantidad</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla_factura">

                {% for item_servicio in item_servicios.all %}
                <tr>
                    <td>{{ item_servicio.tipo_servicio }}</td>
                    <td>{{ item_servicio.tipo_servicio.costo }}</td>
                    <td>{{ item_servicio.cantidad }}</td>
                    <td>
                        <a class="btn btn-danger btn-sm" href="{% url 'eliminar_servicios_factura' item_servicio.id %}" onclick="return confirm('¿Estas seguro que de eliminar la item?')">Eliminar</a>
                    </td>
                </tr>
                {% endfor %} {% for item_articulo in item_articulos.all %}
                <tr>
                    <td>{{ item_articulo.articulo}}</td>
                    <td>{{ item_articulo.articulo.precio_venta }}</td>
                    <td>{{ item_articulo.cantidad }}</td>
                    <td>
                        <a class="btn btn-danger btn-sm" href="{% url 'eliminar_articulos_factura' item_articulo.id %}" onclick="return confirm('¿Estas seguro que de eliminar la item?')">Eliminar</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    $("#cerrar-factura").submit(function (event) {
        event.preventDefault();
        $.ajax({
            url: $(this).attr('action'),
            data: {
                fecha_limite: $('#fecha-limite').val(),
                csrfmiddlewaretoken: $(this).attr('token')
            },
            dataType: "json",
            type: "POST",
            // Si hay un error enviar un mensaje 
            error: function (json) {
            },

            success: function (json) {
                
            },
        });
    });
</script>